---
title: "4_followup_scoredanalysis"
author: "Nick Kathios"
date: '2023-02-25'
output: html_document
---
#load packages
```{r}
library(tidyverse)
library(lme4)
library(lmerTest)
library(emmeans)
library(mediation)
library(corrplot)
library(psych)
library(sjPlot)
source("../reverseCode.R")
```


#load data
```{r}
followup_scored <- read.csv(file='../../data/SLfollowupscored.csv')
```

#correlation matrices
```{r}
#HUMS, eBMRQ, Mental Health, AES corr matrix
variables = dplyr::select(followup_scored, 
                          HUMS_adult_unhealthy,HUMS_adult_healthy,
                          BMRQ_total, BMRQ_moodreg, BMRQ_emotion, BMRQ_socialreward, BMRQ_musicseek, 
                          BMRQ_sensorimotor,PASS_total,
                          STAI_total, CD.RISC_total, AIMS_current_total, SRQ_current_total,positive_escapism_current,
                          negative_escapism_current, AES_viseral, AES_abstract, AES_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c('Unhealthy Adult Music Usage','Healthy Adult Music Usage', 'Total BMRQ', 'Mood Regulation', 
                           'Emotion Evocation', 'Social Reward', 'Music Seeking',
                           'Sensorimotor',"PAS", "STAI", "CDRISC", "AIMS", "SRQ", "Positive Espcapism", 
                           "Negative Espcapism", "AES Viseral", "AES Abstract", "AES total")
rownames(corr_matrix) <- c('Unhealthy Adult Music Usage','Healthy Adult Music Usage', 'Total BMRQ', 'Mood Regulation', 
                           'Emotion Evocation', 'Social Reward', 'Music Seeking',
                           'Sensorimotor',"PAS", "STAI", "CDRISC", "AIMS", "SRQ", "Positive Espcapism", 
                           "Negative Espcapism", "AES Viseral", "AES Abstract", "AES total")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#HUMS, eBMRQ, AES, ELA corr matrix
variables = dplyr::select(followup_scored, 
                          BMRQ_total, BMRQ_moodreg, BMRQ_emotion, BMRQ_socialreward, BMRQ_musicseek, 
                          BMRQ_sensorimotor,AIMS_current_total,QUIC_sum, CHAOS_sum, 
                          deprivation_sum, Threat_sum, QUIC_child_total, CHAOS_child_total, 
                          deprivation_child_total, threat_childhood_total, QUIC_Adolescence_total, 
                          CHAOS_Adolescence_total, deprivation_Adolescence_total, threat_adolescence_total) 
  
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c('Total BMRQ', 'BMRQ - Mood Regulation', 
                           'BMRQ - Emotion Evocation', 'BMRQ -  Social Reward', 
                           'BMRQ - Music Seeking','BMRQ - Sensorimotor Reward', "Absorption (AIMS)", "QUIC Sum", "CHAOS Sum", 
                           "Deprivation Sum","Threat Sum","QUIC Childhood", "CHAOS Childhood", 
                           "Deprivation Childhood","Threat Childhood","QUIC Adolescence", "CHAOS Adolescence", 
                           "Deprivation Adolescence","Threat Adolescence")
rownames(corr_matrix) <- c('Total BMRQ', 'BMRQ - Mood Regulation', 
                           'BMRQ - Emotion Evocation', 'BMRQ -  Social Reward', 
                           'BMRQ - Music Seeking','BMRQ - Sensorimotor Reward', "Absorption (AIMS)", "QUIC Sum", "CHAOS Sum", 
                           "Deprivation Sum","Threat Sum","QUIC Childhood", "CHAOS Childhood", 
                           "Deprivation Childhood","Threat Childhood","QUIC Adolescence", "CHAOS Adolescence", 
                           "Deprivation Adolescence","Threat Adolescence")

pdf(file = "../../figures/statistical_learningfollowup/ELABMRQ.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45,diag=FALSE, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#plotting ELA + Abs scatters
QUIC_AIMS<-
  ggplot(data=followup_scored, aes(x=QUIC_sum, y=AIMS_current_total)) +
         geom_point() +
  geom_smooth(method="lm") +
  theme_classic() +
  xlab("QUIC Sum Score") +
  ylab("AIMS Score") +
  theme( 
    axis.text.x = element_text(size=18),
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=24),
    axis.title.y = element_text(size=24)
  )

cor.test(followup_scored$CHAOS_sum, followup_scored$AIMS_current_total, method="spearman")

ggsave(file='../../figures/AIMS_paper/QUIC_AIMS.png',QUIC_AIMS, dpi=2000)

CD_RISC_AIMS<-
  ggplot(data=followup_scored, aes(x=AIMS_current_total, y=CD.RISC_total)) +
         geom_point() +
  geom_smooth(method="lm") +
  theme_classic() +
  xlab("AIMS Score") +
  ylab("CD.RISC-10 Score") +
  theme( 
    axis.text.x = element_text(size=18),
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=24),
    axis.title.y = element_text(size=24)
  )

cor.test(followup_scored$deprivation_sum, followup_scored$AIMS_current_total, method="spearman")

ggsave(file='../../figures/AIMS_paper/CD_RISC_AIMS.png',CD_RISC_AIMS, dpi=2000)

#gold, eBMRQ-abs, ELA, STAI, resilience, age, HUMS
variables = dplyr::select(followup_scored, 
                          AIMS_current_total, positive_escapism_current, negative_escapism_current,
                          Gold_activeengagement, Gold_musicaltraining,
                          Gold_musicalsophistication, Gold_emotion, Gold_singingabilities, 
                          Gold_perceptualabilities, QUIC_sum, CHAOS_sum, 
                          deprivation_sum, Threat_sum, QUIC_child_total, CHAOS_child_total, 
                          deprivation_child_total, threat_childhood_total, 
                          QUIC_Adolescence_total, 
                          CHAOS_Adolescence_total, deprivation_Adolescence_total, 
                          threat_adolescence_total,
                          HUMS_adult_unhealthy, HUMS_adult_healthy,
                          STAI_total, CD.RISC_total,What.is.your.age.)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c('AIMS', 'Positive Escapism (Self-Expansion)', 'Negative Escapism (Self-Supression)', 'Gold-MSI: Active Engagement', 'Gold-MSI: Musical Training', 'Gold-MSI: General Sophistication', 'Gold-MSI: Emotion', 'Gold-MSI: Singing Abilities', 'Gold-MSI: Perceptual Abilities',  "QUIC Sum", "CHAOS Sum", 
                           "Deprivation Sum","Threat Sum","QUIC Childhood", "CHAOS Childhood", 
                           "Deprivation Childhood","Threat Childhood","QUIC Adolescence", "CHAOS Adolescence", "Deprivation Adolescence","Threat Adolescence", 'Unhealthy Adult Music Usage','Healthy Adult Music Usage',"STAI", "CDRISC", "Age")
rownames(corr_matrix) <- c('AIMS', 'Positive Escapism (Self-Expansion)', 'Negative Escapism (Self-Supression)', 'Gold-MSI: Active Engagement', 'Gold-MSI: Musical Training', 'Gold-MSI: General Sophistication', 'Gold-MSI: Emotion', 'Gold-MSI: Singing Abilities', 'Gold-MSI: Perceptual Abilities',  "QUIC Sum", "CHAOS Sum", 
                           "Deprivation Sum","Threat Sum","QUIC Childhood", "CHAOS Childhood", 
                           "Deprivation Childhood","Threat Childhood","QUIC Adolescence", "CHAOS Adolescence", "Deprivation Adolescence","Threat Adolescence", 'Unhealthy Adult Music Usage','Healthy Adult Music Usage',"STAI", "CDRISC", "Age")

pdf(file = "../../figures/AIMS_paper/Gold_ELAcheckcorrmatrixstudy2.pdf",width=10)

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, diag=FALSE,
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()
```

#which facet of BMRQ is escapism related to?
```{r}
cor.test(followup_scored$CHAOS_sum, followup_scored$BMRQ_moodreg)

followup_scored$escapism_sum <- followup_scored$positive_escapism_current + followup_scored$negative_escapism_current



escapism_AIMS <- followup_scored %>%
  dplyr::select(positive_escapism_current, negative_escapism_current, AIMS_current_total, ID) 

escapism_AIMS$positive_escapism_current <- (escapism_AIMS$positive_escapism_current)/5
escapism_AIMS$negative_escapism_current <- (escapism_AIMS$negative_escapism_current)/6

escapism_AIMS <- escapism_AIMS %>%
  pivot_longer(positive_escapism_current:negative_escapism_current, names_to = "type", values_to = "escapism")

m1 <-lmer(data=escapism_AIMS, scale(escapism) ~  scale(AIMS_current_total)*type + (1|ID))
summary(m1)


m1 <-lm(data=followup_scored, scale(positive_escapism_current) ~  scale(BMRQ_moodreg) + scale(BMRQ_emotion) + scale(BMRQ_socialreward) + scale(BMRQ_musicseek) + scale(BMRQ_sensorimotor) + scale(AIMS_current_total))
summary(m1)

pos_escapism_BMRQ <-
plot_model(m1, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.5, 0.75) +
  ggtitle("Positive Escapism Score") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("Absorption (AIMS)","BMRQ - Sensorimotor Reward","BMRQ - Music Seeking", "BMRQ - Social Reward", "BMRQ - Emotion Evocation","BMRQ - Mood Regulation"))


m1 <-lm(data=followup_scored, scale(negative_escapism_current) ~  scale(BMRQ_moodreg) + scale(BMRQ_emotion) + scale(BMRQ_socialreward) + scale(BMRQ_musicseek) + scale(BMRQ_sensorimotor) + scale(AIMS_current_total))
summary(m1)

plot_model(m1, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.5, 0.75) +
  ggtitle("Negative Escapism Score") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("Absorption (AIMS)","Sensorimotor","Music Seeking", "Social Reward", "Emotion Evocation","Mood Regulation"))
```


#absorption mediation models
```{r}
cor.test(followup_scored$AIMS_current_total, followup_scored$positive_escapism_current)

followup_scored$CHAOS_sum_scaled <- as.vector(scale(followup_scored$CHAOS_sum))
followup_scored$QUIC_sum_scaled <- as.vector(scale(followup_scored$QUIC_sum))

followup_scored$AIMS_current_total_scaled <- as.vector(scale(followup_scored$AIMS_current_total))

followup_scored$escapism_sum_scaled <- as.vector(scale(followup_scored$escapism_sum))

followup_scored$CD.RISC_total_scaled <- as.vector(scale(followup_scored$CD.RISC_total))
followup_scored$deprivation_sum_scaled <- as.vector(scale(followup_scored$deprivation_sum))
followup_scored$threat_sum_scaled <- as.vector(scale(followup_scored$Threat_sum))
followup_scored$CHAOS_child_scaled <- as.vector(scale(followup_scored$CHAOS_child_total))
followup_scored$CHAOS_adolescence_scaled <- as.vector(scale(followup_scored$CHAOS_Adolescence_total))
followup_scored$deprivation_child_total_scaled <- as.vector(scale(followup_scored$deprivation_child_total))
followup_scored$deprivation_Adolescence_total_scaled <- as.vector(scale(followup_scored$deprivation_Adolescence_total))
followup_scored$threat_adolescence_scaled <- as.vector(scale(followup_scored$threat_adolescence_total))
followup_scored$QUIC_adolescence_scaled <- as.vector(scale(followup_scored$QUIC_Adolescence_total))
followup_scored$threat_childhood_scaled <- as.vector(scale(followup_scored$threat_childhood_total))
followup_scored$STAI_total_scaled <- as.vector(scale(followup_scored$STAI_total))
followup_scored$positive_escapism_current_scaled <- as.vector(scale(followup_scored$positive_escapism_current))

followup_scored$Gold_musicaltraining_scaled <- as.vector(scale(followup_scored$Gold_musicaltraining))

#select seed for reproducible results
seed = 111

#HAYES MEDIATION -- added age as a covariate? - need to figure out where to put age in this narrative
## both threat & CD.RISC are pos correlated w. age
followup_scored$age_scaled <- scale(followup_scored$What.is.your.age.)
followup_scored$QUIC_abrscaled <- scale(followup_scored$QUIC_abr)


process(data = followup_scored, y = "CD.RISC_total_scaled", x = "QUIC_abrscaled", m ="AIMS_current_total_scaled", model = 4, seed = seed, cov = "STAI_total_scaled")

cor.test(followup_scored$QUIC_sum, followup_scored$AIMS_current_total_scaled)

cor.test(followup_scored$AIMS_current_total, followup_scored$STAI_total)


ggplot(data=followup_scored, aes(y=CD.RISC_total, x=What.is.your.age.))+
  geom_point()+
  stat_smooth(method="lm")

m1 <-lm(data=followup_scored, scale(STAI_total) ~ scale(QUIC_sum) + scale(CHAOS_sum) + scale(deprivation_sum) + scale(Threat_sum))
summary(m1)

m1 <- lm(data=followup_scored, scale(CD.RISC_total) ~ scale(CHAOS_Adolescence_total)*scale(positive_escapism_current))
summary(m1)

m1 <- lm(data=followup_scored, scale(CD.RISC_total) ~ scale(deprivation_sum, center=114.2672)*scale(AIMS_current_total))
summary(m1)

m2 <- lm(data=followup_scored, scale(CD.RISC_total) ~ scale(deprivation_sum, center=93.48278)*scale(AIMS_current_total))
summary(m2)

mean(followup_scored$deprivation_sum) - sd(followup_scored$deprivation_sum)


range(followup_scored$deprivation_sum)
#plot model predictions
newdata_low <- expand.grid(
  AIMS_current_total=seq(36,170,1)  #deprivation_sum = seq(77,141,1)
)
predictions <- predict(m1, newdata_low,se.fit = TRUE, print.matrix =
        TRUE, type="terms",terms = "AIMS_current_total")

plot_model(m1, type = "pred")




plot_model(m1, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.5, 0.75) +
  ggtitle("AIMS Score") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("Threat Sum","Deprivation Sum","CHAOS Sum", "QUIC Sum"))

m2 <-lm(data=followup_scored, STAI_total ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + AIMS_current_total)
summary(m2)

m2 <-lm(data=followup_scored, escapism_sum ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + PASS_total + STAI_total)
summary(m2)

m2 <-lm(data=followup_scored, negative_escapism_current ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + PASS_total + STAI_total)
summary(m2)

m2 <-lm(data=followup_scored, negative_escapism_current ~ deprivation_sum + CD.RISC_total)
summary(m2)

cor.test(followup_scored$QUIC_child_total, followup_scored$BMRQ_moodreg)
```

#SL results
```{r}
names(liking)[2] <- "ID"
SL_master <- merge(liking, followup_scored, by="ID")

x=1:nrow(SL_master)
for (i in x) {
  if (SL_master$rep[i]<3) {
  SL_master$rep_category[i]="low"
  } else if (SL_master$rep[i]<9) {
    SL_master$rep_category[i]="medium"
  } else if (SL_master$rep[i]>8) {
    SL_master$rep_category[i]="high"
  }
}

SL_master$rep_category <- as.factor(SL_master$rep_category)
SL_master <- within(SL_master, rep_category <- relevel(rep_category, ref = "medium"))

m1 <- lmer(data=SL_master, liking ~ rep_category*outcome_type*QUIC_sum + deprivation_sum + Threat_sum +CHAOS_sum +
             (1|ID) + (1|clipnum))

anova(m1)
summary(m1)



m1 <- lmer(data=SL_master, liking ~ QUIC_sum + deprivation_sum + Threat_sum + rep_category*CHAOS_sum*outcome_type +
             (1|ID) + (1|clipnum))
anova(m1)
summary(m1)

m1 <- lmer(data=SL_master, liking ~ QUIC_sum + deprivation_sum + rep_category*Threat_sum*outcome_type + CHAOS_sum +
             (1|ID) + (1|clipnum))
anova(m1)
summary(m1)
```

#replicating groove results
```{r}
groove_stiminfo$stim <- as.character(groove_stiminfo$stim)
groove<- followup_scored %>%
  dplyr::select("X1_move_1":"X39_pleasure_1")

move_index <- seq(1,30,by=2)
pleasure_index <- seq(2,30, by=2)

move <- groove[move_index] %>%
  cbind(followup_scored[2]) %>%
  pivot_longer(!ID, names_to = "stim", values_to = "rating")

x=1:nrow(move)
for (i in x) {
 move$stim[i] <- gsub("_move_1", "",move$stim[i])
 move$stim[i] <- gsub("X", "",move$stim[i])
}

move <- merge(move, groove_stiminfo)
move$tert <- as.factor(move$tert)

##double check that for the contrasts, the weights are -1,2,-1 to low,intermediate, and high respectively
move <- within(move, tert <- relevel(tert, ref = "Intermediate"))

m1 <- lmer(data=move, rating ~ tert + (1|ID) + (1|stim))
summary(m1)


m.emm <-emmeans(m1, "tert",lmer.df = "satterthwaite",lmerTest.limit = 4320)

contrast(m.emm, 'poly') %>%
  broom::tidy() %>%
  head(3)

#check w/ perceived complexity ratings
m1 <- lmer(data=move, rating ~ PerceivedComplexity + (PerceivedComplexity|ID) + (1|stim))
summary(m1)

m2 <- lmer(data=move, rating ~ poly(PerceivedComplexity,2,raw=TRUE) + (poly(PerceivedComplexity,2,raw=TRUE)|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
summary(m2)
anova(m1,m2)

pleasure <- groove[pleasure_index] %>%
  cbind(followup_scored[2]) %>%
  pivot_longer(!ID, names_to = "stim", values_to = "rating")

x=1:nrow(pleasure)
for (i in x) {
 pleasure$stim[i] <- gsub("_pleasure_1", "",pleasure$stim[i])
 pleasure$stim[i] <- gsub("X", "",pleasure$stim[i])
}

pleasure <- merge(pleasure, groove_stiminfo)
pleasure$tert <- as.factor(pleasure$tert)
pleasure <- within(pleasure, tert <- relevel(tert, ref = "Intermediate"))

m1 <- lmer(data=pleasure, rating ~ tert + (tert|ID) + (1|stim))
summary(m1)

m.emm <- emmeans(m1, "tert",lmer.df = "satterthwaite",lmerTest.limit = 4320)

contrast(m.emm, 'poly') %>%
  broom::tidy() %>%
  head(3)

#check w/ perceived complexity ratings
m1 <- lmer(data=pleasure, rating ~ PerceivedComplexity + (PerceivedComplexity|ID) + (1|stim))
summary(m1)

m2 <- lmer(data=pleasure, rating ~ poly(PerceivedComplexity,2,raw=TRUE) + (poly(PerceivedComplexity,2,raw=TRUE)|ID) + (1|stim),ontrol=lmerControl(optimizer="bobyqa"))
summary(m2)
anova(m1,m2)
```

#checking to see different preferences across ELA experiences
```{r}
#MOVE RATINGS
move_master <- merge(move, followup_scored, by="ID")
m1 <- lmer(data=move_master, scale(rating) ~ scale(QUIC_sum)*tert + scale(Threat_sum) + scale(deprivation_sum) + scale(CHAOS_sum)*tert + scale(PASS_total) + scale(STAI_total) + (tert|ID) + (1|stim))
anova(m1)
summary(m1)
performance::check_collinearity(m1)
#investigate interaction
emmeans::emtrends(m1, "tert", var = "QUIC_sum",lmer.df = "satterthwaite",lmerTest.limit = 4320) %>%
  emmeans::test()

pleasure_master <- merge(pleasure, followup_scored, by="ID")

#PLEASANTNESS RATINGS
m1 <- lmer(data=pleasure_master, scale(rating) ~ scale(QUIC_sum)*tert + scale(Threat_sum) + scale(deprivation_sum) + scale(CHAOS_sum) + scale(PASS_total) + scale(STAI_total)+(1|ID) + (1|stim), control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)
performance::check_collinearity(m1)

#Threat + Deprivation Checks
m1 <- lmer(data=pleasure_master, scale(rating) ~ scale(QUIC_sum) + scale(Threat_sum)*tert + scale(deprivation_sum) + scale(CHAOS_sum) + scale(PASS_total) + scale(STAI_total) + (tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
summary(m1)
anova(m1)
emmeans::emtrends(m1, "tert", var = "Threat_sum",lmer.df = "satterthwaite",lmerTest.limit = 4320) %>%
  emmeans::test()

m1 <- lmer(data=pleasure_master, scale(rating) ~ scale(QUIC_sum) + scale(Threat_sum) + scale(deprivation_sum)*tert + scale(CHAOS_sum) + scale(PASS_total) + scale(STAI_total) +(tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
summary(m1)
anova(m1)
```

#checking timing
```{r}
m1 <- lmer(data=move_master, rating ~ QUIC_child_total*tert + threat_childhood_total + deprivation_child_total + CHAOS_child_total*tert + PASS_total + STAI_total + (tert|ID) + (1|stim))
anova(m1)
summary(m1)

m1 <- lmer(data=pleasure_master, rating ~  QUIC_child_total*tert + threat_childhood_total + deprivation_child_total + CHAOS_child_total*tert + PASS_total + STAI_total+(tert|ID) + (1|stim))
anova(m1)
summary(m1)

#adolescence
m1 <- lmer(data=move_master, rating ~ QUIC_Adolescence_total*tert + threat_adolescence_total + deprivation_Adolescence_total + CHAOS_Adolescence_total*tert + PASS_total + STAI_total + (tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)

m1 <- lmer(data=pleasure_master, rating ~  QUIC_Adolescence_total*tert + threat_adolescence_total + deprivation_Adolescence_total + CHAOS_Adolescence_total*tert + PASS_total + STAI_total+(tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)

#threat
m1 <- lmer(data=move_master, rating ~ QUIC_child_total + threat_childhood_total*tert + deprivation_child_total + CHAOS_child_total + PASS_total + STAI_total + (tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)

m1 <- lmer(data=move_master, rating ~  QUIC_Adolescence_total + threat_adolescence_total*tert + deprivation_Adolescence_total + CHAOS_Adolescence_total + PASS_total + STAI_total+(tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)

m1 <- lmer(data=pleasure_master, scale(rating) ~ scale(QUIC_child_total) + scale(threat_childhood_total)*tert + scale(deprivation_child_total) + scale(CHAOS_child_total) + scale(PASS_total) + scale(STAI_total) + (tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)
emmeans::emtrends(m1, "tert", var = "threat_childhood_total",lmer.df = "satterthwaite",lmerTest.limit = 4320) %>%
  emmeans::test()


m1 <- lmer(data=move_master, rating ~  QUIC_Adolescence_total + threat_adolescence_total*tert + deprivation_Adolescence_total + CHAOS_Adolescence_total + PASS_total + STAI_total+(tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)
```

#building models on linear data + extracting Bs
```{r}
m2 <- lmer(data=SL_master, liking ~ poly(rep,2,raw=TRUE)*outcome_type + (poly(rep,2,raw=TRUE)*outcome_type|ID))
summary(m2)
quadratic <- coef(m2)$ID
quadratic <- tibble::rownames_to_column(quadratic, "ID")
names(quadratic)[3] <- "linear_beta"
names(quadratic)[4] <- "quadratic_beta"

quad_master <- merge(quadratic, followup_scored, by="ID")
#correlation matrices

variables = dplyr::select(quad_master, 
                          linear_beta,quadratic_beta,
                          outcome_typeOriginal, QUIC_sum, CHAOS_sum, Threat_sum, deprivation_sum)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of # of Presentations", "Quadratic Effect of # of 
                           Presentations","Effect of Alteration","QUIC Sum","CHAOS Sum",
                           "Threat Sum", "Deprivation Sum")
rownames(corr_matrix) <- c("Linear Effect of # of Presentations", "Quadratic Effect of # of 
                           Presentations","Effect of Alteration","QUIC Sum","CHAOS Sum",
                           "Threat Sum", "Deprivation Sum")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#childhood
variables = dplyr::select(quad_master, 
                          linear_beta,quadratic_beta,
                          outcome_typeOriginal, QUIC_child_total, CHAOS_child_total, threat_childhood_total, deprivation_child_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of # of Presentations", "Quadratic Effect of # of 
                           Presentations","Effect of Alteration","QUIC Childhood","CHAOS Childhood",
                           "Threat Childhood", "Deprivation Childhood")
rownames(corr_matrix) <- c("Linear Effect of # of Presentations", "Quadratic Effect of # of 
                           Presentations","Effect of Alteration","QUIC Childhood","CHAOS Childhood",
                           "Threat Childhood", "Deprivation Childhood")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#adol
variables = dplyr::select(quad_master, 
                          linear_beta,quadratic_beta,
                          outcome_typeOriginal, QUIC_Adolescence_total, CHAOS_Adolescence_total, threat_adolescence_total, deprivation_Adolescence_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of # of Presentations", "Quadratic Effect of # of 
                           Presentations","Effect of Alteration","QUIC Adolescence","CHAOS Adolescence",
                           "Threat Adolescence", "Deprivation Adolescence")
rownames(corr_matrix) <- c("Linear Effect of # of Presentations", "Quadratic Effect of # of 
                           Presentations","Effect of Alteration","QUIC Adolescence","CHAOS Adolescence",
                           "Threat Adolescence", "Deprivation Adolescence")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()
```

#building models on linear data + extracting Bs
```{r}
#ratings of pleasure
m2 <- lmer(data=pleasure, rating ~ poly(PerceivedComplexity,2,raw=TRUE) + (poly(PerceivedComplexity,2,raw=TRUE)|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
summary(m2)
groove <- coef(m2)$ID
groove <- tibble::rownames_to_column(groove, "ID")
names(groove)[3] <- "linear_beta"
names(groove)[4] <- "quadratic_beta"
groove_master <- merge(followup_scored, groove, by="ID")

#correlation matrices

variables = dplyr::select(groove_master, 
                          linear_beta,quadratic_beta, QUIC_sum, CHAOS_sum, Threat_sum, 
                          deprivation_sum)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Sum","CHAOS Sum",
                           "Threat Sum", "Deprivation Sum")
rownames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Sum","CHAOS Sum",
                           "Threat Sum", "Deprivation Sum")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#childhood
variables = dplyr::select(groove_master, 
                          linear_beta,quadratic_beta,
                         QUIC_child_total, CHAOS_child_total, threat_childhood_total, deprivation_child_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Childhood","CHAOS Childhood",
                           "Threat Childhood", "Deprivation Childhood")
rownames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Childhood","CHAOS Childhood",
                           "Threat Childhood", "Deprivation Childhood")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#adol
variables = dplyr::select(groove_master, 
                          linear_beta,quadratic_beta,
                           QUIC_Adolescence_total, CHAOS_Adolescence_total, threat_adolescence_total, deprivation_Adolescence_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Adolescence","CHAOS Adolescence",
                           "Threat Adolescence", "Deprivation Adolescence")
rownames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Adolescence","CHAOS Adolescence",
                           "Threat Adolescence", "Deprivation Adolescence")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#ratings of movement
m2 <- lmer(data=move, rating ~ poly(PerceivedComplexity,2,raw=TRUE) + (poly(PerceivedComplexity,2,raw=TRUE)|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
summary(m2)
groove <- coef(m2)$ID
groove <- tibble::rownames_to_column(groove, "ID")
names(groove)[3] <- "linear_beta"
names(groove)[4] <- "quadratic_beta"
groove_master <- merge(followup_scored, groove, by="ID")

#correlation matrices
variables = dplyr::select(groove_master, 
                          linear_beta,quadratic_beta, QUIC_sum, CHAOS_sum, Threat_sum, 
                          deprivation_sum)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Sum","CHAOS Sum",
                           "Threat Sum", "Deprivation Sum")
rownames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Sum","CHAOS Sum",
                           "Threat Sum", "Deprivation Sum")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#childhood
variables = dplyr::select(groove_master, 
                          linear_beta,quadratic_beta,
                         QUIC_child_total, CHAOS_child_total, threat_childhood_total, deprivation_child_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Childhood","CHAOS Childhood",
                           "Threat Childhood", "Deprivation Childhood")
rownames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Childhood","CHAOS Childhood",
                           "Threat Childhood", "Deprivation Childhood")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#adol
variables = dplyr::select(groove_master, 
                          linear_beta,quadratic_beta,
                           QUIC_Adolescence_total, CHAOS_Adolescence_total, threat_adolescence_total, deprivation_Adolescence_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Adolescence","CHAOS Adolescence",
                           "Threat Adolescence", "Deprivation Adolescence")
rownames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Adolescence","CHAOS Adolescence",
                           "Threat Adolescence", "Deprivation Adolescence")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()
```

#model test of linear beta ~ quic
```{r}
m1 <- lm(data=groove_master, scale(linear_beta) ~ scale(QUIC_Adolescence_total) + scale(CHAOS_Adolescence_total) + scale(threat_adolescence_total) + scale(deprivation_Adolescence_total) + scale(PASS_total) + scale(STAI_total))
summary(m1)

plot_model(m1, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.5, 0.5) +
  ggtitle("Linear Beta Estimate (Move)") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("STAI","PAS","Deprivation Adolescence ", "Threat Adoelscence", "Deprivation Adolescence","QUIC Adoelscence"))

m1t <- lm(data=groove_master, scale(linear_beta) ~ scale(QUIC_Adolescence_total) + scale(QUIC_child_total) + scale(PASS_total) + scale(STAI_total))
summary(m1t)

plot_model(m1t, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.5, 0.5) +
  ggtitle("Linear Beta Estimate (Move)") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("STAI","PAS","QUIC Childhood", "QUIC Adoelscence"))
```

#AES
```{r}
m1 <- lm(data=followup_scored, scale(QUIC_sum) ~ scale(AES_viseral) + scale(AES_abstract))
summary(m1)

m2 <- lm(data=followup_scored, scale(CHAOS_sum) ~ scale(AES_viseral) + scale(AES_abstract))
summary(m2)

m3 <- lm(data=followup_scored, scale(Threat_sum) ~ scale(AES_viseral) + scale(AES_abstract))
summary(m3)

m4 <- lm(data=followup_scored, scale(deprivation_sum) ~ scale(AES_viseral) + scale(AES_abstract))
summary(m4)

##does it mediate escapism
m1 <-lm(data=followup_scored, scale(AES_abstract) ~ scale(QUIC_sum) + scale(CHAOS_sum) + scale(deprivation_sum) + scale(Threat_sum) + scale(PASS_total) + scale(STAI_total))
summary(m1)

m2 <-lm(data=followup_scored, AES_abstract ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + escapism_sum)
summary(m2)

m2 <-lm(data=followup_scored, AES_abstract ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + positive_escapism_current)
summary(m2)


m2 <-lm(data=followup_scored, AES_abstract ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + PASS_total + STAI_total)
summary(m2)

m2 <-lm(data=followup_scored, negative_escapism_current ~ scale(AES_viseral) + scale(AES_abstract))
summary(m2)

m2 <-lm(data=followup_scored, positive_escapism_current ~ scale(AES_viseral) + scale(AES_abstract))
summary(m2)

cor.test(followup_scored$AES_, followup_scored$QUIC_sum)
```

#items analysis
```{r}
#is there a latent construct these measures are measuring?
#items <- cbind(followup_scored[312:351], followup_scored[398:399],followup_scored[402:403],followup_scored[405:407])

## get items for AIMS + Escapism
items <- cbind(followup_scored[312:356])  %>%
  rename_at(.vars = vars(starts_with("AIMS_current")),
            .funs = funs(sub("AIMS_current", "", .))) %>%
  mutate_if(is.character, as.numeric)
# followup_scored[385:397], followup_scored[398:411])

items <- scale(items)

parallel <- fa.parallel(items) #suggests 8 factors
MAP <- vss(items)
MAP <- MAP[["map"]]
print(MAP) #suggests 8

fa.none <- psych::fa(r=items, 
 nfactors = 4, 
  covar = FALSE, SMC = TRUE,
 fm="ml", 
 max.iter=100,  
 rotate="oblimin") # 
summary(fa.none)

SL_transformation <- EFAtools::SL(fa.none)
SL_transformation <- SL_transformation[[2]]
SL_transformation



scores <- fa.none[["scores"]]

update <- cbind(scores, followup_scored)

##try general scores!!

cor.test(update$ML2, followup_scored$STAI_total)



##scoring AIMS - escapism (from EFA w/ escapism + AIMS: these were the items that loaded w/ "neg" escapism)
cols_escapismAIMS <- c("AIMS_current2_1","AIMS_current3_1","AIMS_current4_1","AIMS_current5_1","AIMS_current6_1","AIMS_current7_1","AIMS_current8_1","AIMS_current9_1","AIMS_current10_1","AIMS_current11_1","AIMS_current12_1","AIMS_current13_1","AIMS_current14_1","AIMS_current15_1","AIMS_current16_1","AIMS_current17_1","AIMS_current19_1","AIMS_current21_1","AIMS_current23_1","AIMS_current24_1","AIMS_current27_1","AIMS_current28_1","AIMS_current29_1","AIMS_current30_1","AIMS_current31_1","AIMS_current32_1","AIMS_current33_1","AIMS_current34_1")


followup_scored$AIMS_escapism <- apply(followup_scored[cols_escapismAIMS], 1,sum)

cor.test(followup_scored$threat_adolescence_total, followup_scored$AIMS_escapism)

m1 <- lm(child)

followup_scored$threat_childhood_total

m1 <- lm(data=followup_scored, scale(CD.RISC_total) ~ scale(threat_childhood_total)*scale(AIMS_escapism))
summary(m1)

m1 <- lm(data=followup_scored, scale(CD.RISC_total) ~ scale(AIMS_escapism))
summary(m1)



#mediation
all_scored$CHAOS_sum_scaled <- as.vector(scale(all_scored$CHAOS_sum))
followup_scored$AIMS_escapism_scaled <- as.vector(scale(followup_scored$AIMS_escapism))
all_scored$CD.RISC_total_scaled <- as.vector(scale(all_scored$CD.RISC_total))
followup_scored$deprivation_sum_scaled <- as.vector(scale(followup_scored$deprivation_sum))
followup_scored$threat_sum_scaled <- as.vector(scale(followup_scored$Threat_sum))
followup_scored$CHAOS_child_scaled <- as.vector(scale(followup_scored$CHAOS_child_total))
followup_scored$CHAOS_adolescence_scaled <- as.vector(scale(followup_scored$CHAOS_Adolescence_total))
followup_scored$deprivation_child_total_scaled <- as.vector(scale(followup_scored$deprivation_child_total))
followup_scored$deprivation_Adolescence_total_scaled <- as.vector(scale(followup_scored$deprivation_Adolescence_total))
all_scored$BMRQ_absorption <- as.vector(scale(all_scored$BMRQ_absorption))

m1 <-lm(data=all_scored, CD.RISC_total_scaled ~ CHAOS_sum_scaled)

m2 <-lm(data=all_scored, CD.RISC_total_scaled ~  CHAOS_sum_scaled + BMRQ_absorption)

mediate <- mediation::mediate(m1,m2, boot=TRUE, treat = "CHAOS_sum_scaled", mediator = "BMRQ_absorption", sims=10000)
summary(mediate)


m2 <-lm(data=followup_scored, scale(CD.RISC_total_scaled) ~  scale(Threat_sum)*scale(AIMS_escapism))

m2 <-lm(data=followup_scored, scale(CD.RISC_total_scaled) ~  scale(deprivation_child_total)*scale(AIMS_escapism))
mean(all_scored$deprivation_sum) - sd(all_scored$deprivation_sum)
summary(m2)

ggplot(data=followup_scored, aes(x=CD.RISC_total, y=deprivation_sum))+
  geom_point() +
  theme_classic()

### does timing matter for absorption (both samples) && those that are related to cdrisc

##check timing relationships across both samples
```

#HUMS & AIMS
```{r}
HUMS_AIMS <- 
followup_scored %>%
  dplyr::select(ID, AIMS_current_total, HUMS_adult_unhealthy, HUMS_adult_healthy)

HUMS_AIMS$HUMS_adult_unhealthy <- scale(HUMS_AIMS$HUMS_adult_unhealthy)
HUMS_AIMS$HUMS_adult_healthy <- scale(HUMS_AIMS$HUMS_adult_healthy)

HUMS_AIMS <-HUMS_AIMS %>%
  pivot_longer(HUMS_adult_unhealthy:HUMS_adult_healthy, names_to = "usage_type", values_to = "HUMS")

HUMS_AIMS$usage_type <- as.factor(HUMS_AIMS$usage_type)
contrasts(HUMS_AIMS$usage_type) <- c(-0.5,0.5)
HUMS_AIMS$AIMS_scaled <- scale(HUMS_AIMS$AIMS_current_total)


m1 <- lmer((HUMS) ~ (AIMS_scaled)*usage_type + (1|ID), data=HUMS_AIMS)
summary(m1)

##plotting

newdata <- expand.grid(
  AIMS_scaled=seq(-2.8090675,2.0247280,0.01),
  HUMS = seq(-3.3741340, 4.1651413, 0.1),
  usage_type = c("HUMS_adult_unhealthy", "HUMS_adult_healthy")
)

predictions<- predictSE(m1, newdata, se.fit = TRUE, print.matrix =
        TRUE, level = 0)

pred <- cbind(newdata, predictions)
pred$AIMS_current_total <-pred$AIMS_scaled * attr(HUMS_AIMS$AIMS_scaled, 'scaled:scale') + attr(HUMS_AIMS$AIMS_scaled, 'scaled:center')


HUMS_AIMS_plot<-
  ggplot(data=pred, aes(x=AIMS_current_total, y=fit)) +
  geom_line(aes(col=usage_type))+
  geom_ribbon(aes(ymin=fit-se.fit, ymax=fit+se.fit, fill=usage_type),alpha=0.25) +
  ylab('Music Usage Score \n(within subscale Z-score)') +
  xlab('AIMS Score') +
  theme_classic() +
 theme(
   legend.position = "none",
    axis.title.x = element_text(family="Arial", size=22),
    axis.title.y = element_text(family="Arial",size=22),
    axis.text.x = element_text(family="Arial", size=20),
    axis.text.y = element_text(family="Arial",size=20),
    strip.text.x = element_text(family="Arial",size=20)
  ) +
   scale_color_manual(values=c("#56B4E9","#E69F00")) +
  scale_fill_manual(values=c("#56B4E9","#E69F00")) +
  geom_point(aes(y=HUMS, color=usage_type), data=HUMS_AIMS, alpha=0.5)

ggsave('../../figures/AIMS_paper/HUMS_AIMS2.png', HUMS_AIMS_plot, dpi=2000)
```

#resilience & AIMS plot
```{r}
AIMS_resilience <-
  ggplot(data=followup_scored, aes(x=AIMS_current_total, y=CD.RISC_total)) +
  geom_jitter(width = 0.065,height=0.065, alpha=0.5) +
  theme_classic() +
  geom_smooth(method="lm", color='black') +
  xlab("Absorption (AIMS) Score") +
  ylab("Resilience Score")+
  theme( 
    axis.text.x = element_text(size=18),
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=24),
    axis.title.y = element_text(size=24)
  )

ggsave(AIMS_resilience, file='../../figures/statistical_learningfollowup/AIMS_resilience.png')

cor.test(followup_scored$AIMS_current_total, followup_scored$CD.RISC_total)
```

#getting reliability measures
```{r}
CHAOS_child <- followup_scored %>%
  dplyr::select("CHAOS_child1_1":"CHAOS_child15_1")

cols_reverse <- c("CHAOS_child1_1", "CHAOS_child2_1", "CHAOS_child4_1", "CHAOS_child7_1",
                   "CHAOS_child12_1", "CHAOS_child14_1","CHAOS_child15_1")

CHAOS_child[cols_reverse] <- lapply(CHAOS_child[cols_reverse], reverseCode, min=1, max=5)
```

#AIMS + escapism
```{r}
#first order correlation
#sum
AIMS_escapismsum<-
  ggplot(data=followup_scored, aes(x=AIMS_current_total, y=escapism_sum)) +
  geom_point(alpha=0.75)+
  geom_smooth(method="lm") +
  theme_classic() +
  xlab("AIMS Score") +
  ylab("Escapism Sum Score") +
  theme( 
    axis.text.x = element_text(size=18),
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=24),
    axis.title.y = element_text(size=24)
  )
cor.test(followup_scored$AIMS_current_total, followup_scored$escapism_sum)
ggsave('../../figures/AIMS_paper/AIMS_escapismsum.png', AIMS_escapismsum, dpi=2000)

#pos
AIMS_selfexpansion<-
  ggplot(data=followup_scored, aes(x=AIMS_current_total, y=positive_escapism_current)) +
  geom_point(alpha=0.75)+
  geom_smooth(method="lm") +
  theme_classic() +
  xlab("AIMS Score") +
  ylab("Self Expansion Escapism Score") +
  theme( 
    axis.text.x = element_text(size=18),
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=24),
    axis.title.y = element_text(size=24)
  )
cor.test(followup_scored$AIMS_current_total, followup_scored$positive_escapism_current)
ggsave('../../figures/AIMS_paper/AIMS_selfexpansion.png', AIMS_selfexpansion, dpi=350)

#neg
AIMS_selfsupression<-
  ggplot(data=followup_scored, aes(x=AIMS_current_total, y=negative_escapism_current)) +
  geom_point(alpha=0.75)+
  geom_smooth(method="lm") +
  theme_classic() +
  xlab("AIMS Score") +
  ylab("Self Supression Escapism Score") +
  theme( 
    axis.text.x = element_text(size=18),
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=24),
    axis.title.y = element_text(size=24)
  )
cor.test(followup_scored$AIMS_current_total, followup_scored$negative_escapism_current)
ggsave('../../figures/AIMS_paper/AIMS_selfsupression.png', AIMS_selfsupression, dpi=350)

#interaction comparison
escapism_AIMS <- 
followup_scored %>%
  dplyr::select(ID, AIMS_current_total, negative_escapism_current, positive_escapism_current)

escapism_AIMS$negative_escapism_current <- scale(escapism_AIMS$negative_escapism_current)
escapism_AIMS$positive_escapism_current <- scale(escapism_AIMS$positive_escapism_current)

escapism_AIMS <-escapism_AIMS %>%
  pivot_longer(negative_escapism_current:positive_escapism_current, names_to = "escapism_type", values_to = "escapism")

escapism_AIMS$escapism_type <- as.factor(escapism_AIMS$escapism_type)
contrasts(escapism_AIMS$escapism_type) <- c(-0.5,0.5)
escapism_AIMS$AIMS_scaled <- scale(escapism_AIMS$AIMS_current_total)


m1 <- lmer((escapism) ~ (AIMS_scaled)*escapism_type + (1|ID), data=escapism_AIMS)
summary(m1)

##plotting

newdata <- expand.grid(
  AIMS_scaled=seq(-2.8090675,2.0247280,0.01),
  HUMS = seq(-2.223430, 1.527875, 0.1),
  escapism_type = c("negative_escapism_current", "positive_escapism_current")
)

predictions<- predictSE(m1, newdata, se.fit = TRUE, print.matrix =
        TRUE, level = 0)

pred <- cbind(newdata, predictions)
pred$AIMS_current_total <-pred$AIMS_scaled * attr(escapism_AIMS$AIMS_scaled, 'scaled:scale') + attr(escapism_AIMS$AIMS_scaled, 'scaled:center')
pred$escapism_type <- ifelse(pred$escapism_type=="negative_escapism_current", "Self Suppression", "Self Expansion")
escapism_AIMS$escapism_type <- ifelse(escapism_AIMS$escapism_type=="negative_escapism_current", "Self Suppression", "Self Expansion")

escapism_AIMS_plot<-
  ggplot(data=pred, aes(x=AIMS_current_total, y=fit)) +
  geom_line(aes(col=escapism_type))+
  geom_ribbon(aes(ymin=fit-se.fit, ymax=fit+se.fit, fill=escapism_type),alpha=0.25) +
  ylab('Escapism Score \n(within subscale Z-score)') +
  xlab('AIMS Score') +
  theme_classic() +
 theme(
   legend.position = "none",
    axis.title.x = element_text(family="Arial", size=22),
    axis.title.y = element_text(family="Arial",size=22),
    axis.text.x = element_text(family="Arial", size=20),
    axis.text.y = element_text(family="Arial",size=20),
    strip.text.x = element_text(family="Arial",size=20),
  ) +
    scale_color_manual(values=c("#0072B2", "#D55E00" )) +
  scale_fill_manual(values=c("#0072B2","#D55E00")) +
  geom_point(aes(y=escapism, color=escapism_type), data=escapism_AIMS, alpha=0.5)

ggsave('../../figures/AIMS_paper/escapism_AIMS.png', escapism_AIMS_plot, dpi=2000)

#getting labels
label <- expand.grid(
 AIMS_scaled=0,
  HUMS = 1.5,
  escapism_type = c("negative_escapism_current", "positive_escapism_current")
)

label$HUMS <- ifelse(label$escapism_type=="negative_escapism_current", label$HUMS -1, label$HUMS )

label$escapism_type <- ifelse(label$escapism_type=="negative_escapism_current", "Self Suppression", "Self Expansion")

AIMS_escap_label <- 
  ggplot(data=label, aes(x=AIMS_scaled, y=HUMS)) +
  scale_color_manual(values=c("#0072B2", "#D55E00" )) +
  scale_fill_manual(values=c("#0072B2","#D55E00"))  +
  geom_label_repel(aes(label = escapism_type, color=escapism_type),
   #              nudge_x = -0.8,
    #               na.rm = TRUE,
                  data=label,
                   family="Arial",
                 size=6,
                 min.segment.length = Inf) +
    theme_classic()

ggsave(AIMS_escap_label, file='../../figures/AIMS_paper/AIMS_escap_label.png', dpi=2000)

#subscale analyses
m1 <-lm(data=followup_scored, scale(escapism_sum) ~  scale(BMRQ_moodreg) + scale(BMRQ_emotion) + scale(BMRQ_socialreward) + scale(BMRQ_musicseek) + scale(BMRQ_sensorimotor) + scale(AIMS_current_total))
summary(m1)


escapismcoef <-
  plot_model(m1, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.8, 0.8) +
  ggtitle("Escapism Score") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("Absorption (AIMS)","BMRQ - Sensorimotor Reward","BMRQ - Music Seeking", "BMRQ - Social Reward", "BMRQ - Emotion Evocation","BMRQ - Mood Regulation")) +
  geom_hline(yintercept=0,color='black',linetype='dashed')

ggsave(escapismcoef, file='../../figures/AIMS_paper/escapismcoef.png', width=10, dpi=2000)

#pos
m1 <-lm(data=followup_scored, scale(positive_escapism_current) ~  scale(BMRQ_moodreg) + scale(BMRQ_emotion) + scale(BMRQ_socialreward) + scale(BMRQ_musicseek) + scale(BMRQ_sensorimotor) + scale(AIMS_current_total))
summary(m1)


selfexpansion_subscale <-
  plot_model(m1, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.8, 0.8) +
  ggtitle("Self Expansion Escapism Score") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("Absorption (AIMS)","BMRQ - Sensorimotor Reward","BMRQ - Music Seeking", "BMRQ - Social Reward", "BMRQ - Emotion Evocation","BMRQ - Mood Regulation")) +
  geom_hline(yintercept=0,color='black',linetype='dashed')

ggsave(selfexpansion_subscale, file='../../figures/AIMS_paper/selfexpansion_subscale.png', width=10, dpi=2000)

#neg
m1 <-lm(data=followup_scored, scale(negative_escapism_current) ~  scale(BMRQ_moodreg) + scale(BMRQ_emotion) + scale(BMRQ_socialreward) + scale(BMRQ_musicseek) + scale(BMRQ_sensorimotor) + scale(AIMS_current_total))
summary(m1)


selfsuppression_subscale <-
  plot_model(m1, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.8, 0.8) +
  ggtitle("Self Suppression Escapism Score") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("Absorption (AIMS)","BMRQ - Sensorimotor Reward","BMRQ - Music Seeking", "BMRQ - Social Reward", "BMRQ - Emotion Evocation","BMRQ - Mood Regulation")) +
  geom_hline(yintercept=0,color='black',linetype='dashed')

ggsave(selfsuppression_subscale, file='../../figures/AIMS_paper/selfsuppression_subscale.png', width=10, dpi=2000)
```

#plotting abs-res
```{r}
AIMS_dep<-
  ggplot(data=followup_scored, aes(x=deprivation_sum, y=AIMS_current_total,)) +
  geom_point()+
  geom_smooth(method="lm") +
  theme_classic() +
  xlab("Total Deprivation Score") +
  ylab("AIMS Score") +
  theme( 
    axis.text.x = element_text(size=18),
    axis.text.y = element_text(size=18),
    axis.title.x = element_text(size=24),
    axis.title.y = element_text(size=24)
  ) 
  #scale_x_continuous(breaks=c(30,60,90,120,150))

cor.test(followup_scored$AIMS_current_total, followup_scored$Threat_sum)

ggsave(file='../../figures/AIMS_paper/AIMS_dep.png',AIMS_dep)
```