---
title: "4_followup_scoredanalysis"
author: "Nick Kathios"
date: '2023-02-25'
output: html_document
---
#load packages
```{r}
library(tidyverse)
library(lme4)
library(lmerTest)
library(emmeans)
library(mediation)
library(corrplot)
library(psych)
library(sjPlot)
library(mediation)
```


#load data
```{r}
followup_scored <- read.csv(file='../../data/SLfollowupscored.csv')


liking <- read.csv(file='../../data/SL_followup/masterinteractionliking.csv')
groove_stiminfo <- read.csv(file="../../stimuli/senn_stim/stim_information.csv")
names(groove_stiminfo)[2] <- "stim"
```

#correlation matrices
```{r}
#HUMS, eBMRQ, Mental Health, AES corr matrix
variables = dplyr::select(followup_scored, 
                          HUMS_adult_unhealthy,HUMS_adult_healthy,
                          BMRQ_total, BMRQ_moodreg, BMRQ_emotion, BMRQ_socialreward, BMRQ_musicseek, 
                          BMRQ_sensorimotor,PASS_total,
                          STAI_total, CD.RISC_total, AIMS_current_total, SRQ_current_total,positive_escapism_current,
                          negative_escapism_current, AES_viseral, AES_abstract, AES_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c('Unhealthy Adult Music Usage','Healthy Adult Music Usage', 'Total BMRQ', 'Mood Regulation', 
                           'Emotion Evocation', 'Social Reward', 'Music Seeking',
                           'Sensorimotor',"PAS", "STAI", "CDRISC", "AIMS", "SRQ", "Positive Espcapism", 
                           "Negative Espcapism", "AES Viseral", "AES Abstract", "AES total")
rownames(corr_matrix) <- c('Unhealthy Adult Music Usage','Healthy Adult Music Usage', 'Total BMRQ', 'Mood Regulation', 
                           'Emotion Evocation', 'Social Reward', 'Music Seeking',
                           'Sensorimotor',"PAS", "STAI", "CDRISC", "AIMS", "SRQ", "Positive Espcapism", 
                           "Negative Espcapism", "AES Viseral", "AES Abstract", "AES total")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#HUMS, eBMRQ, AES, ELA corr matrix
variables = dplyr::select(followup_scored, 
                          HUMS_adult_unhealthy,HUMS_adult_healthy,
                          BMRQ_total, BMRQ_moodreg, BMRQ_emotion, BMRQ_socialreward, BMRQ_musicseek, 
                          BMRQ_sensorimotor,AIMS_current_total,positive_escapism_current,
                          negative_escapism_current, AES_viseral, AES_abstract, AES_total, QUIC_sum, CHAOS_sum, 
                          Threat_sum, deprivation_sum) 
  
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c('Unhealthy Adult Music Usage','Healthy Adult Music Usage', 'Total BMRQ', 'Mood Regulation', 
                           'Emotion Evocation', 'Social Reward', 'Music Seeking',
                           'Sensorimotor', "AIMS", "Positive Espcapism", 
                           "Negative Espcapism", "AES Viseral", "AES Abstract", "AES Total", "QUIC Sum", "CHAOS Sum", 
                           "Threat Sum", "Deprivation Sum")
rownames(corr_matrix) <- c('Unhealthy Adult Music Usage','Healthy Adult Music Usage', 'Total BMRQ', 'Mood Regulation', 
                           'Emotion Evocation', 'Social Reward', 'Music Seeking',
                           'Sensorimotor', "AIMS", "Positive Espcapism", 
                           "Negative Espcapism", "AES Viseral", "AES Abstract", "AES Total","QUIC Sum", "CHAOS Sum", 
                           "Threat Sum", "Deprivation Sum")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_AIMS_ELA.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()
```

#which facet of BMRQ is escapism related to?
```{r}
cor.test(followup_scored$AIMS_current_total, followup_scored$deprivation_sum)
followup_scored$escapism_sum <- followup_scored$positive_escapism_current + followup_scored$negative_escapism_current

m1 <-lm(data=followup_scored, scale(escapism_sum) ~  scale(BMRQ_moodreg) + scale(BMRQ_emotion) + scale(BMRQ_socialreward) + scale(BMRQ_musicseek) + scale(BMRQ_sensorimotor) + scale(AIMS_current_total))
summary(m1)

plot_model(m1, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.25, 1) +
  ggtitle("Overall Escapism Score") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("Absorption (AIMS)","Sensorimotor","Music Seeking", "Social Reward", "Emotion Evocation","Mood Regulation"))

m1 <-lm(data=followup_scored, scale(positive_escapism_current) ~  scale(BMRQ_moodreg) + scale(BMRQ_emotion) + scale(BMRQ_socialreward) + scale(BMRQ_musicseek) + scale(BMRQ_sensorimotor) + scale(AIMS_current_total))
summary(m1)

plot_model(m1, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.5, 0.75) +
  ggtitle("Positive Escapism Score") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("Absorption (AIMS)","Sensorimotor","Music Seeking", "Social Reward", "Emotion Evocation","Mood Regulation"))

m1 <-lm(data=followup_scored, scale(negative_escapism_current) ~  scale(BMRQ_moodreg) + scale(BMRQ_emotion) + scale(BMRQ_socialreward) + scale(BMRQ_musicseek) + scale(BMRQ_sensorimotor) + scale(AIMS_current_total))
summary(m1)

plot_model(m1, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.5, 0.75) +
  ggtitle("Negative Escapism Score") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("Absorption (AIMS)","Sensorimotor","Music Seeking", "Social Reward", "Emotion Evocation","Mood Regulation"))
```


#absorption mediation models
```{r}
cor.test(followup_scored$QUIC_sum, followup_scored$AIMS_current_total)
followup_scored$CHAOS_sum_scaled <- as.vector(scale(followup_scored$CHAOS_sum))
followup_scored$QUIC_sum_scaled <- as.vector(scale(followup_scored$QUIC_sum))
followup_scored$AIMS_current_total_scaled <- as.vector(scale(followup_scored$AIMS_current_total))
followup_scored$AIMS_escapism_scaled <- as.vector(scale(followup_scored$AIMS_escapism))
followup_scored$CD.RISC_total_scaled <- as.vector(scale(followup_scored$CD.RISC_total))
followup_scored$deprivation_sum_scaled <- as.vector(scale(followup_scored$deprivation_sum))
followup_scored$threat_sum_scaled <- as.vector(scale(followup_scored$Threat_sum))
followup_scored$CHAOS_child_scaled <- as.vector(scale(followup_scored$CHAOS_child_total))
followup_scored$CHAOS_adolescence_scaled <- as.vector(scale(followup_scored$CHAOS_Adolescence_total))
followup_scored$deprivation_child_total_scaled <- as.vector(scale(followup_scored$deprivation_child_total))
followup_scored$deprivation_Adolescence_total_scaled <- as.vector(scale(followup_scored$deprivation_Adolescence_total))

#test for PASS (?) + CD RISC with deprivation, CHAOS, and threat
m1 <-lm(data=followup_scored, CD.RISC_total_scaled ~ QUIC_sum_scaled)
m2 <-lm(data=followup_scored, CD.RISC_total_scaled ~  QUIC_sum_scaled + AIMS_current_total_scaled)

summary(m1)
mediate <- mediation::mediate(m1,m2, boot=TRUE, treat = "QUIC_sum_scaled", mediator = "AIMS_current_total_scaled")
summary(mediate)

seed=8061999

#TRYING HAYES MEDIATION -- giving different answers than mediate package, also need to pick seed no
process(data = followup_scored, y = "PASS_total", x = "QUIC_sum_scaled", m ="AIMS_current_total_scaled", model = 4, seed=seed)


m1 <-lm(data=followup_scored, scale(STAI_total) ~ scale(QUIC_sum) + scale(CHAOS_sum) + scale(deprivation_sum) + scale(Threat_sum))
summary(m1)

m1 <- lm(data=followup_scored, scale(CD.RISC_total) ~ scale(CHAOS_Adolescence_total)*scale(positive_escapism_current))
summary(m1)

m1 <- lm(data=followup_scored, scale(CD.RISC_total) ~ scale(deprivation_sum, center=114.2672)*scale(AIMS_current_total))
summary(m1)

m2 <- lm(data=followup_scored, scale(CD.RISC_total) ~ scale(deprivation_sum, center=93.48278)*scale(AIMS_current_total))
summary(m2)

mean(followup_scored$deprivation_sum) - sd(followup_scored$deprivation_sum)


range(followup_scored$deprivation_sum)
#plot model predictions
newdata_low <- expand.grid(
  AIMS_current_total=seq(36,170,1)  #deprivation_sum = seq(77,141,1)
)
predictions <- predict(m1, newdata_low,se.fit = TRUE, print.matrix =
        TRUE, type="terms",terms = "AIMS_current_total")

plot_model(m1, type = "pred")




plot_model(m1, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.5, 0.75) +
  ggtitle("AIMS Score") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("Threat Sum","Deprivation Sum","CHAOS Sum", "QUIC Sum"))

m2 <-lm(data=followup_scored, STAI_total ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + AIMS_current_total)
summary(m2)

m2 <-lm(data=followup_scored, escapism_sum ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + PASS_total + STAI_total)
summary(m2)

m2 <-lm(data=followup_scored, negative_escapism_current ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + PASS_total + STAI_total)
summary(m2)

m2 <-lm(data=followup_scored, negative_escapism_current ~ deprivation_sum + CD.RISC_total)
summary(m2)

cor.test(followup_scored$AIMS_current_total, followup_scored$CD.RISC_total)
```

#SL results
```{r}
names(liking)[2] <- "ID"
SL_master <- merge(liking, followup_scored, by="ID")

x=1:nrow(SL_master)
for (i in x) {
  if (SL_master$rep[i]<3) {
  SL_master$rep_category[i]="low"
  } else if (SL_master$rep[i]<9) {
    SL_master$rep_category[i]="medium"
  } else if (SL_master$rep[i]>8) {
    SL_master$rep_category[i]="high"
  }
}

SL_master$rep_category <- as.factor(SL_master$rep_category)
SL_master <- within(SL_master, rep_category <- relevel(rep_category, ref = "medium"))

m1 <- lmer(data=SL_master, liking ~ rep_category*outcome_type*QUIC_sum + deprivation_sum + Threat_sum +CHAOS_sum +
             (1|ID) + (1|clipnum))

anova(m1)
summary(m1)



m1 <- lmer(data=SL_master, liking ~ QUIC_sum + deprivation_sum + Threat_sum + rep_category*CHAOS_sum*outcome_type +
             (1|ID) + (1|clipnum))
anova(m1)
summary(m1)

m1 <- lmer(data=SL_master, liking ~ QUIC_sum + deprivation_sum + rep_category*Threat_sum*outcome_type + CHAOS_sum +
             (1|ID) + (1|clipnum))
anova(m1)
summary(m1)
```

#replicating groove results
```{r}
groove_stiminfo$stim <- as.character(groove_stiminfo$stim)
groove<- followup_scored %>%
  dplyr::select("X1_move_1":"X39_pleasure_1")

move_index <- seq(1,30,by=2)
pleasure_index <- seq(2,30, by=2)

move <- groove[move_index] %>%
  cbind(followup_scored[2]) %>%
  pivot_longer(!ID, names_to = "stim", values_to = "rating")

x=1:nrow(move)
for (i in x) {
 move$stim[i] <- gsub("_move_1", "",move$stim[i])
 move$stim[i] <- gsub("X", "",move$stim[i])
}

move <- merge(move, groove_stiminfo)
move$tert <- as.factor(move$tert)

##double check that for the contrasts, the weights are -1,2,-1 to low,intermediate, and high respectively
move <- within(move, tert <- relevel(tert, ref = "Intermediate"))

m1 <- lmer(data=move, rating ~ tert + (1|ID) + (1|stim))
summary(m1)


m.emm <-emmeans(m1, "tert",lmer.df = "satterthwaite",lmerTest.limit = 4320)

contrast(m.emm, 'poly') %>%
  broom::tidy() %>%
  head(3)

#check w/ perceived complexity ratings
m1 <- lmer(data=move, rating ~ PerceivedComplexity + (PerceivedComplexity|ID) + (1|stim))
summary(m1)

m2 <- lmer(data=move, rating ~ poly(PerceivedComplexity,2,raw=TRUE) + (poly(PerceivedComplexity,2,raw=TRUE)|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
summary(m2)
anova(m1,m2)

pleasure <- groove[pleasure_index] %>%
  cbind(followup_scored[2]) %>%
  pivot_longer(!ID, names_to = "stim", values_to = "rating")

x=1:nrow(pleasure)
for (i in x) {
 pleasure$stim[i] <- gsub("_pleasure_1", "",pleasure$stim[i])
 pleasure$stim[i] <- gsub("X", "",pleasure$stim[i])
}

pleasure <- merge(pleasure, groove_stiminfo)
pleasure$tert <- as.factor(pleasure$tert)
pleasure <- within(pleasure, tert <- relevel(tert, ref = "Intermediate"))

m1 <- lmer(data=pleasure, rating ~ tert + (tert|ID) + (1|stim))
summary(m1)

m.emm <- emmeans(m1, "tert",lmer.df = "satterthwaite",lmerTest.limit = 4320)

contrast(m.emm, 'poly') %>%
  broom::tidy() %>%
  head(3)

#check w/ perceived complexity ratings
m1 <- lmer(data=pleasure, rating ~ PerceivedComplexity + (PerceivedComplexity|ID) + (1|stim))
summary(m1)

m2 <- lmer(data=pleasure, rating ~ poly(PerceivedComplexity,2,raw=TRUE) + (poly(PerceivedComplexity,2,raw=TRUE)|ID) + (1|stim),ontrol=lmerControl(optimizer="bobyqa"))
summary(m2)
anova(m1,m2)
```

#checking to see different preferences across ELA experiences
```{r}
#MOVE RATINGS
move_master <- merge(move, followup_scored, by="ID")
m1 <- lmer(data=move_master, scale(rating) ~ scale(QUIC_sum)*tert + scale(Threat_sum) + scale(deprivation_sum) + scale(CHAOS_sum)*tert + scale(PASS_total) + scale(STAI_total) + (tert|ID) + (1|stim))
anova(m1)
summary(m1)
performance::check_collinearity(m1)
#investigate interaction
emmeans::emtrends(m1, "tert", var = "QUIC_sum",lmer.df = "satterthwaite",lmerTest.limit = 4320) %>%
  emmeans::test()

pleasure_master <- merge(pleasure, followup_scored, by="ID")

#PLEASANTNESS RATINGS
m1 <- lmer(data=pleasure_master, scale(rating) ~ scale(QUIC_sum)*tert + scale(Threat_sum) + scale(deprivation_sum) + scale(CHAOS_sum) + scale(PASS_total) + scale(STAI_total)+(1|ID) + (1|stim), control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)
performance::check_collinearity(m1)

#Threat + Deprivation Checks
m1 <- lmer(data=pleasure_master, scale(rating) ~ scale(QUIC_sum) + scale(Threat_sum)*tert + scale(deprivation_sum) + scale(CHAOS_sum) + scale(PASS_total) + scale(STAI_total) + (tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
summary(m1)
anova(m1)
emmeans::emtrends(m1, "tert", var = "Threat_sum",lmer.df = "satterthwaite",lmerTest.limit = 4320) %>%
  emmeans::test()

m1 <- lmer(data=pleasure_master, scale(rating) ~ scale(QUIC_sum) + scale(Threat_sum) + scale(deprivation_sum)*tert + scale(CHAOS_sum) + scale(PASS_total) + scale(STAI_total) +(tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
summary(m1)
anova(m1)
```

#checking timing
```{r}
m1 <- lmer(data=move_master, rating ~ QUIC_child_total*tert + threat_childhood_total + deprivation_child_total + CHAOS_child_total*tert + PASS_total + STAI_total + (tert|ID) + (1|stim))
anova(m1)
summary(m1)

m1 <- lmer(data=pleasure_master, rating ~  QUIC_child_total*tert + threat_childhood_total + deprivation_child_total + CHAOS_child_total*tert + PASS_total + STAI_total+(tert|ID) + (1|stim))
anova(m1)
summary(m1)

#adolescence
m1 <- lmer(data=move_master, rating ~ QUIC_Adolescence_total*tert + threat_adolescence_total + deprivation_Adolescence_total + CHAOS_Adolescence_total*tert + PASS_total + STAI_total + (tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)

m1 <- lmer(data=pleasure_master, rating ~  QUIC_Adolescence_total*tert + threat_adolescence_total + deprivation_Adolescence_total + CHAOS_Adolescence_total*tert + PASS_total + STAI_total+(tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)

#threat
m1 <- lmer(data=move_master, rating ~ QUIC_child_total + threat_childhood_total*tert + deprivation_child_total + CHAOS_child_total + PASS_total + STAI_total + (tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)

m1 <- lmer(data=move_master, rating ~  QUIC_Adolescence_total + threat_adolescence_total*tert + deprivation_Adolescence_total + CHAOS_Adolescence_total + PASS_total + STAI_total+(tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)

m1 <- lmer(data=pleasure_master, scale(rating) ~ scale(QUIC_child_total) + scale(threat_childhood_total)*tert + scale(deprivation_child_total) + scale(CHAOS_child_total) + scale(PASS_total) + scale(STAI_total) + (tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)
emmeans::emtrends(m1, "tert", var = "threat_childhood_total",lmer.df = "satterthwaite",lmerTest.limit = 4320) %>%
  emmeans::test()


m1 <- lmer(data=move_master, rating ~  QUIC_Adolescence_total + threat_adolescence_total*tert + deprivation_Adolescence_total + CHAOS_Adolescence_total + PASS_total + STAI_total+(tert|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
anova(m1)
summary(m1)
```

#building models on linear data + extracting Bs
```{r}
m2 <- lmer(data=SL_master, liking ~ poly(rep,2,raw=TRUE)*outcome_type + (poly(rep,2,raw=TRUE)*outcome_type|ID))
summary(m2)
quadratic <- coef(m2)$ID
quadratic <- tibble::rownames_to_column(quadratic, "ID")
names(quadratic)[3] <- "linear_beta"
names(quadratic)[4] <- "quadratic_beta"

quad_master <- merge(quadratic, followup_scored, by="ID")
#correlation matrices

variables = dplyr::select(quad_master, 
                          linear_beta,quadratic_beta,
                          outcome_typeOriginal, QUIC_sum, CHAOS_sum, Threat_sum, deprivation_sum)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of # of Presentations", "Quadratic Effect of # of 
                           Presentations","Effect of Alteration","QUIC Sum","CHAOS Sum",
                           "Threat Sum", "Deprivation Sum")
rownames(corr_matrix) <- c("Linear Effect of # of Presentations", "Quadratic Effect of # of 
                           Presentations","Effect of Alteration","QUIC Sum","CHAOS Sum",
                           "Threat Sum", "Deprivation Sum")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#childhood
variables = dplyr::select(quad_master, 
                          linear_beta,quadratic_beta,
                          outcome_typeOriginal, QUIC_child_total, CHAOS_child_total, threat_childhood_total, deprivation_child_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of # of Presentations", "Quadratic Effect of # of 
                           Presentations","Effect of Alteration","QUIC Childhood","CHAOS Childhood",
                           "Threat Childhood", "Deprivation Childhood")
rownames(corr_matrix) <- c("Linear Effect of # of Presentations", "Quadratic Effect of # of 
                           Presentations","Effect of Alteration","QUIC Childhood","CHAOS Childhood",
                           "Threat Childhood", "Deprivation Childhood")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#adol
variables = dplyr::select(quad_master, 
                          linear_beta,quadratic_beta,
                          outcome_typeOriginal, QUIC_Adolescence_total, CHAOS_Adolescence_total, threat_adolescence_total, deprivation_Adolescence_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of # of Presentations", "Quadratic Effect of # of 
                           Presentations","Effect of Alteration","QUIC Adolescence","CHAOS Adolescence",
                           "Threat Adolescence", "Deprivation Adolescence")
rownames(corr_matrix) <- c("Linear Effect of # of Presentations", "Quadratic Effect of # of 
                           Presentations","Effect of Alteration","QUIC Adolescence","CHAOS Adolescence",
                           "Threat Adolescence", "Deprivation Adolescence")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()
```

#building models on linear data + extracting Bs
```{r}
#ratings of pleasure
m2 <- lmer(data=pleasure, rating ~ poly(PerceivedComplexity,2,raw=TRUE) + (poly(PerceivedComplexity,2,raw=TRUE)|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
summary(m2)
groove <- coef(m2)$ID
groove <- tibble::rownames_to_column(groove, "ID")
names(groove)[3] <- "linear_beta"
names(groove)[4] <- "quadratic_beta"
groove_master <- merge(followup_scored, groove, by="ID")

#correlation matrices

variables = dplyr::select(groove_master, 
                          linear_beta,quadratic_beta, QUIC_sum, CHAOS_sum, Threat_sum, 
                          deprivation_sum)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Sum","CHAOS Sum",
                           "Threat Sum", "Deprivation Sum")
rownames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Sum","CHAOS Sum",
                           "Threat Sum", "Deprivation Sum")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#childhood
variables = dplyr::select(groove_master, 
                          linear_beta,quadratic_beta,
                         QUIC_child_total, CHAOS_child_total, threat_childhood_total, deprivation_child_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Childhood","CHAOS Childhood",
                           "Threat Childhood", "Deprivation Childhood")
rownames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Childhood","CHAOS Childhood",
                           "Threat Childhood", "Deprivation Childhood")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#adol
variables = dplyr::select(groove_master, 
                          linear_beta,quadratic_beta,
                           QUIC_Adolescence_total, CHAOS_Adolescence_total, threat_adolescence_total, deprivation_Adolescence_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Adolescence","CHAOS Adolescence",
                           "Threat Adolescence", "Deprivation Adolescence")
rownames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Adolescence","CHAOS Adolescence",
                           "Threat Adolescence", "Deprivation Adolescence")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#ratings of movement
m2 <- lmer(data=move, rating ~ poly(PerceivedComplexity,2,raw=TRUE) + (poly(PerceivedComplexity,2,raw=TRUE)|ID) + (1|stim),control=lmerControl(optimizer="bobyqa"))
summary(m2)
groove <- coef(m2)$ID
groove <- tibble::rownames_to_column(groove, "ID")
names(groove)[3] <- "linear_beta"
names(groove)[4] <- "quadratic_beta"
groove_master <- merge(followup_scored, groove, by="ID")

#correlation matrices
variables = dplyr::select(groove_master, 
                          linear_beta,quadratic_beta, QUIC_sum, CHAOS_sum, Threat_sum, 
                          deprivation_sum)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Sum","CHAOS Sum",
                           "Threat Sum", "Deprivation Sum")
rownames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Sum","CHAOS Sum",
                           "Threat Sum", "Deprivation Sum")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#childhood
variables = dplyr::select(groove_master, 
                          linear_beta,quadratic_beta,
                         QUIC_child_total, CHAOS_child_total, threat_childhood_total, deprivation_child_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Childhood","CHAOS Childhood",
                           "Threat Childhood", "Deprivation Childhood")
rownames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Childhood","CHAOS Childhood",
                           "Threat Childhood", "Deprivation Childhood")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#adol
variables = dplyr::select(groove_master, 
                          linear_beta,quadratic_beta,
                           QUIC_Adolescence_total, CHAOS_Adolescence_total, threat_adolescence_total, deprivation_Adolescence_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Adolescence","CHAOS Adolescence",
                           "Threat Adolescence", "Deprivation Adolescence")
rownames(corr_matrix) <- c("Linear Effect of Complexity", "Quadratic Effect of Complexity","QUIC Adolescence","CHAOS Adolescence",
                           "Threat Adolescence", "Deprivation Adolescence")

pdf(file = "../../figures/statistical_learningfollowup_scored/BMRQ_HUMS_mentalhealth_AIMS.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()
```

#model test of linear beta ~ quic
```{r}
m1 <- lm(data=groove_master, scale(linear_beta) ~ scale(QUIC_Adolescence_total) + scale(CHAOS_Adolescence_total) + scale(threat_adolescence_total) + scale(deprivation_Adolescence_total) + scale(PASS_total) + scale(STAI_total))
summary(m1)

plot_model(m1, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.5, 0.5) +
  ggtitle("Linear Beta Estimate (Move)") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("STAI","PAS","Deprivation Adolescence ", "Threat Adoelscence", "Deprivation Adolescence","QUIC Adoelscence"))

m1t <- lm(data=groove_master, scale(linear_beta) ~ scale(QUIC_Adolescence_total) + scale(QUIC_child_total) + scale(PASS_total) + scale(STAI_total))
summary(m1t)

plot_model(m1t, show.values = TRUE,vline.color = "lightgrey") + 
 ylim(-0.5, 0.5) +
  ggtitle("Linear Beta Estimate (Move)") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("STAI","PAS","QUIC Childhood", "QUIC Adoelscence"))
```

#AES
```{r}
m1 <- lm(data=followup_scored, scale(QUIC_sum) ~ scale(AES_viseral) + scale(AES_abstract))
summary(m1)

m2 <- lm(data=followup_scored, scale(CHAOS_sum) ~ scale(AES_viseral) + scale(AES_abstract))
summary(m2)

m3 <- lm(data=followup_scored, scale(Threat_sum) ~ scale(AES_viseral) + scale(AES_abstract))
summary(m3)

m4 <- lm(data=followup_scored, scale(deprivation_sum) ~ scale(AES_viseral) + scale(AES_abstract))
summary(m4)

##does it mediate escapism
m1 <-lm(data=followup_scored, scale(AES_abstract) ~ scale(QUIC_sum) + scale(CHAOS_sum) + scale(deprivation_sum) + scale(Threat_sum) + scale(PASS_total) + scale(STAI_total))
summary(m1)

m2 <-lm(data=followup_scored, AES_abstract ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + escapism_sum)
summary(m2)

m2 <-lm(data=followup_scored, AES_abstract ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + positive_escapism_current)
summary(m2)


m2 <-lm(data=followup_scored, AES_abstract ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + PASS_total + STAI_total)
summary(m2)

m2 <-lm(data=followup_scored, negative_escapism_current ~ scale(AES_viseral) + scale(AES_abstract))
summary(m2)

m2 <-lm(data=followup_scored, positive_escapism_current ~ scale(AES_viseral) + scale(AES_abstract))
summary(m2)

cor.test(followup_scored$AES_, followup_scored$QUIC_sum)
```

#items analysis
```{r}
#is there a latent construct these measures are measuring?
#items <- cbind(followup_scored[312:351], followup_scored[398:399],followup_scored[402:403],followup_scored[405:407])

## get items for AIMS + Escapism
items <- cbind(followup_scored[312:356])  %>%
  rename_at(.vars = vars(starts_with("AIMS_current")),
            .funs = funs(sub("AIMS_current", "", .))) %>%
  mutate_if(is.character, as.numeric)
# followup_scored[385:397], followup_scored[398:411])

items <- scale(items)

parallel <- fa.parallel(items) #suggests 8 factors
MAP <- vss(items)
MAP <- MAP[["map"]]
print(MAP) #suggests 8

fa.none <- psych::fa(r=items, 
 nfactors = 4, 
  covar = FALSE, SMC = TRUE,
 fm="ml", 
 max.iter=100,  
 rotate="oblimin") # 
summary(fa.none)

SL_transformation <- EFAtools::SL(fa.none)
SL_transformation <- SL_transformation[[2]]
SL_transformation



scores <- fa.none[["scores"]]

update <- cbind(scores, followup_scored)

##try general scores!!

cor.test(update$ML2, followup_scored$STAI_total)



##scoring AIMS - escapism (from EFA w/ escapism + AIMS: these were the items that loaded w/ "neg" escapism)
cols_escapismAIMS <- c("AIMS_current2_1","AIMS_current3_1","AIMS_current4_1","AIMS_current5_1","AIMS_current6_1","AIMS_current7_1","AIMS_current8_1","AIMS_current9_1","AIMS_current10_1","AIMS_current11_1","AIMS_current12_1","AIMS_current13_1","AIMS_current14_1","AIMS_current15_1","AIMS_current16_1","AIMS_current17_1","AIMS_current19_1","AIMS_current21_1","AIMS_current23_1","AIMS_current24_1","AIMS_current27_1","AIMS_current28_1","AIMS_current29_1","AIMS_current30_1","AIMS_current31_1","AIMS_current32_1","AIMS_current33_1","AIMS_current34_1")


followup_scored$AIMS_escapism <- apply(followup_scored[cols_escapismAIMS], 1,sum)

cor.test(followup_scored$threat_adolescence_total, followup_scored$AIMS_escapism)

m1 <- lm(child)

followup_scored$threat_childhood_total

m1 <- lm(data=followup_scored, scale(CD.RISC_total) ~ scale(threat_childhood_total)*scale(AIMS_escapism))
summary(m1)

m1 <- lm(data=followup_scored, scale(CD.RISC_total) ~ scale(AIMS_escapism))
summary(m1)



#mediation
all_scored$CHAOS_sum_scaled <- as.vector(scale(all_scored$CHAOS_sum))
followup_scored$AIMS_escapism_scaled <- as.vector(scale(followup_scored$AIMS_escapism))
all_scored$CD.RISC_total_scaled <- as.vector(scale(all_scored$CD.RISC_total))
followup_scored$deprivation_sum_scaled <- as.vector(scale(followup_scored$deprivation_sum))
followup_scored$threat_sum_scaled <- as.vector(scale(followup_scored$Threat_sum))
followup_scored$CHAOS_child_scaled <- as.vector(scale(followup_scored$CHAOS_child_total))
followup_scored$CHAOS_adolescence_scaled <- as.vector(scale(followup_scored$CHAOS_Adolescence_total))
followup_scored$deprivation_child_total_scaled <- as.vector(scale(followup_scored$deprivation_child_total))
followup_scored$deprivation_Adolescence_total_scaled <- as.vector(scale(followup_scored$deprivation_Adolescence_total))
all_scored$BMRQ_absorption <- as.vector(scale(all_scored$BMRQ_absorption))

m1 <-lm(data=all_scored, CD.RISC_total_scaled ~ CHAOS_sum_scaled)

m2 <-lm(data=all_scored, CD.RISC_total_scaled ~  CHAOS_sum_scaled + BMRQ_absorption)

mediate <- mediation::mediate(m1,m2, boot=TRUE, treat = "CHAOS_sum_scaled", mediator = "BMRQ_absorption", sims=10000)
summary(mediate)


m2 <-lm(data=followup_scored, scale(CD.RISC_total_scaled) ~  scale(Threat_sum)*scale(AIMS_escapism))

m2 <-lm(data=followup_scored, scale(CD.RISC_total_scaled) ~  scale(deprivation_child_total)*scale(AIMS_escapism))
mean(all_scored$deprivation_sum) - sd(all_scored$deprivation_sum)
summary(m2)

ggplot(data=followup_scored, aes(x=CD.RISC_total, y=deprivation_sum))+
  geom_point() +
  theme_classic()

### does timing matter for absorption (both samples) && those that are related to cdrisc

##check timing relationships across both samples
```

