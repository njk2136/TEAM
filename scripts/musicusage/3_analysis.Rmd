---
title: "3_analysis"
author: "Nick Kathios"
date: '2023-01-16'
output: html_document
---

#load packages
```{r}
library(tidyverse)
library(lmerTest)
library(MuMIn)
library(AICcmodavg)
library(sjPlot)
library(corrplot)
library(psych)
```

#read in data
```{r}
all_scored <- read.csv(file="../../data/pleasing-displeasing_followup/music_usage/all_scored.csv")
```

#HUMS, eBMRQ, Mental Health corr matrix
```{r}
#HUMS, eBMRQ, Mental Health
variables = dplyr::select(all_scored, 
                          HUMS_adolescence_unhealthy, HUMS_adult_unhealthy,
                          HUMS_adolescence_healthy, HUMS_adult_healthy,
                          BMRQ_total, BMRQ_moodreg, BMRQ_emotion, BMRQ_socialreward,
                          BMRQ_absorption, BMRQ_musicseek, BMRQ_sensorimotor,PASS_total,
                          STAI_total, CD.RISC_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c('Unhealthy Adolescent Music Usage', 'Unhealthy Adult Music Usage','Healthy Adolescent Music Usage','Healthy Adult Music Usage', 'Total BMRQ', 'Mood Regulation', 'Emotion Evocation', 'Social Reward', 'Absorption', 'Music Seeking',
                           'Sensorimotor',"PAS", "STAI", "CDRISC")
rownames(corr_matrix) <- c('Unhealthy Adolescent Music Usage', 'Unhealthy Adult Music Usage','Healthy Adolescent Music Usage','Healthy Adult Music Usage', 'Total BMRQ', 'Mood Regulation', 'Emotion Evocation', 'Social Reward', 'Absorption', 'Music Seeking',
                           'Sensorimotor', "PAS", "STAI", "CDRISC")

pdf(file = "../../figures/pleasing:displeasing_followup/full_sample/eBMRQ_HUMS_mentalhealth.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()
```

#HUMS ~ eBMRQ
```{r}
m1 <- lm(scale(HUMS_adult_unhealthy) ~ scale(BMRQ_socialreward) + scale(BMRQ_emotion) + scale(BMRQ_moodreg) + scale(BMRQ_sensorimotor) + scale(BMRQ_musicseek) + scale(BMRQ_absorption), data=all_scored)
summary(m1)

m1 <- lm(scale(HUMS_adult_healthy) ~ scale(BMRQ_socialreward) + scale(BMRQ_emotion) + scale(BMRQ_moodreg) + scale(BMRQ_sensorimotor) + scale(BMRQ_musicseek) + scale(BMRQ_absorption) + scale(PASS_total) + scale(STAI_total), data=all_scored)
summary(m1)
summary <- summary(m1)
summary <- as.data.frame(summary[["coefficients"]])
p <- summary$`Pr(>|t|)`
p.adjust(p, method = "fdr", n = length(p))
#plot

eBMRQ_HUMS_coef <- 
plot_model(m1, show.values = TRUE,vline.color = "lightgrey") + 
  ylim(-.6, .6) +
  ggtitle("Healthy Music Usage Scores") +
  ylab("Standardized Beta Coefficient Estimates")+
  theme_light() +
  theme(title=element_text(family="Arial", size=20),
    axis.title.x = element_text(family="Arial", size=18),
    axis.title.y = element_text(family="Arial",size=18),
    axis.text.x = element_text(family="Arial", size=16),
    axis.text.y = element_text(family="Arial",size=16),
  ) +
  scale_x_discrete(labels=c("STAI", "PAS", "Absorption", "Music Seeking","Sensorimotor","Mood Regulation", "Emotion Evocation", "Social Reward"))

ggsave(plot=eBMRQ_HUMS_coef, '../../figures/pleasing:displeasing_followup/full_sample/eBMRQ_HUMS_coef.png',width=10)
```

#corrplots
```{r}
#eBMRQ + ELA Sum
variables = dplyr::select(all_scored, 
                          BMRQ_total, BMRQ_moodreg, BMRQ_emotion, BMRQ_socialreward,
                          BMRQ_absorption, BMRQ_musicseek, BMRQ_sensorimotor, QUIC_sum, 
                          CHAOS_sum, deprivation_sum, Threat_sum)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c('Total BMRQ', 'Mood Regulation', 'Emotion Evocation', 'Social Reward', 'Absorption', 'Music Seeking',
                           'Sensorimotor', "QUIC Sum", "CHAOS Sum", "Deprivation Sum", "Threat Sum")
rownames(corr_matrix) <- c('Total BMRQ', 'Mood Regulation', 'Emotion Evocation', 'Social Reward', 'Absorption', 'Music Seeking',
                           'Sensorimotor', "QUIC Sum", "CHAOS Sum", "Deprivation Sum", "Threat Sum")

pdf(file = "../../figures/pleasing:displeasing_followup/BMRQ_corrplot_totals.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()

#childhood
variables = dplyr::select(all_scored, 
                          BMRQ_total, BMRQ_moodreg, BMRQ_emotion, BMRQ_socialreward,
                          BMRQ_absorption, BMRQ_musicseek, BMRQ_sensorimotor, QUIC_child_total, 
                          CHAOS_child_total, deprivation_child_total, threat_childhood_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c('Total BMRQ', 'Mood Regulation', 'Emotion Evocation', 'Social Reward', 'Absorption', 'Music Seeking',
                           'Sensorimotor', "QUIC Childhood", "CHAOS Childhood", "Deprivation Childhood", "Threat Childhood")
rownames(corr_matrix) <- c('Total BMRQ', 'Mood Regulation', 'Emotion Evocation', 'Social Reward', 'Absorption', 'Music Seeking',
                           'Sensorimotor', "QUIC Childhood", "CHAOS Childhood", "Deprivation Childhood", "Threat Childhood")
pdf(file = "../../figures/pleasing:displeasing_followup/BMRQ_corrplot_childhood.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()


#adolescence
variables = dplyr::select(all_scored, 
                          BMRQ_total, BMRQ_moodreg, BMRQ_emotion, BMRQ_socialreward,
                          BMRQ_absorption, BMRQ_musicseek, BMRQ_sensorimotor, QUIC_Adolescence_total, 
                          CHAOS_Adolescence_total, deprivation_Adolescence_total, threat_adolescence_total)
output = corr.test(variables)

corr_matrix = output$r
p_matrix <- output$p

colnames(corr_matrix) <- c('Total BMRQ', 'Mood Regulation', 'Emotion Evocation', 'Social Reward', 'Absorption', 'Music Seeking',
                           'Sensorimotor', "QUIC Adolescence", "CHAOS Adolescence", "Deprivation Adolescence", "Threat Adolescence")
rownames(corr_matrix) <- c('Total BMRQ', 'Mood Regulation', 'Emotion Evocation', 'Social Reward', 'Absorption', 'Music Seeking',
                           'Sensorimotor', "QUIC Adolescence", "CHAOS Adolescence", "Deprivation Adolescence", "Threat Adolescence")

pdf(file = "../../figures/pleasing:displeasing_followup/BMRQ_corrplot_adolescence.pdf")

corrplot(corr_matrix, p.mat = p_matrix, insig = "label_sig",
         sig.level = c(0.001,0.01,0.05), pch.cex=0.9, pch.col = "black", tl.col = "black", type="lower",tl.srt =45, 
         col=colorRampPalette(c("darkblue","white","red"))(100),cl.lim=c(0,1))

dev.off()
```

#is absorption related to ELA above and beyond other measures?
```{r}
m1 <-  lm(BMRQ_absorption ~ PASS_total + STAI_total, data=all_scored)
summary(m1)
m1 <- lm(CHAOS_sum ~ BMRQ_socialreward + BMRQ_emotion + BMRQ_moodreg + BMRQ_sensorimotor + BMRQ_musicseek + BMRQ_absorption , data=all_scored)
summary(m1)
summary <- summary(m1)
summary <- as.data.frame(summary[["coefficients"]])
p <- summary$`Pr(>|t|)`
p.adjust(p, method = "fdr", n = length(p))

m1 <- lm(QUIC_sum ~ BMRQ_socialreward + BMRQ_emotion + BMRQ_moodreg + BMRQ_sensorimotor + BMRQ_musicseek + BMRQ_absorption + PASS_total + STAI_total, data=all_scored)

summary(m1)
summary <- summary(m1)
summary <- as.data.frame(summary[["coefficients"]])
p <- summary$`Pr(>|t|)`
p.adjust(p, method = "fdr", n = length(p))

m1 <- lm(deprivation_sum ~ BMRQ_socialreward + BMRQ_emotion + BMRQ_moodreg + BMRQ_sensorimotor + BMRQ_musicseek + BMRQ_absorption + PASS_total + STAI_total, data=all_scored)
summary(m1)
summary <- summary(m1)
summary <- as.data.frame(summary[["coefficients"]])
p <- summary$`Pr(>|t|)`
p.adjust(p, method = "fdr", n = length(p))

m1 <- lm(Threat_sum ~ BMRQ_socialreward + BMRQ_emotion + BMRQ_moodreg + BMRQ_sensorimotor + BMRQ_musicseek + BMRQ_absorption, data=all_scored)
summary(m1)

#is there evidence that absorption is adaptive?
cor.test(all_scored$BMRQ_absorption, all_scored$CD.RISC_total)
cor.test(all_scored$BMRQ_absorption, all_scored$HUMS_adult_healthy)
cor.test(all_scored$BMRQ_absorption, all_scored$HUMS_adult_unhealthy)
```

#is any dimension of ELA related to music reward sensitivity? or healthy / unhealthy music usage?
```{r}
m1 <- lm(BMRQ_absorption ~ CHAOS_sum + QUIC_sum + deprivation_sum + Threat_sum + PASS_total + STAI_total, data=all_scored)
summary(m1)

m2 <- lm(HUMS_adult_healthy ~ CHAOS_sum + QUIC_sum + deprivation_sum + Threat_sum + PASS_total + STAI_total, data=all_scored)
summary(m2)

m3 <- lm(HUMS_adult_unhealthy ~  CHAOS_sum + STAI_total + PASS_total , data=all_scored)
summary(m3)
summary <- summary(m3)
summary <- as.data.frame(summary[["coefficients"]])
p <- summary$`Pr(>|t|)`
p.adjust(p, method = "fdr", n = length(p))
```

#is one dimenions of ELA associated w/ abs?
```{r}
m1 <- lm(BMRQ_absorption ~ CHAOS_sum + QUIC_sum + deprivation_sum + Threat_sum + PASS_total + STAI_total, data=all_scored)
summary(m1)
```

#moderation?
```{r}
m1 <- lm(scale(CD.RISC_totl) ~ scale(deprivation_sum)*scale(BMRQ_absorption), data=all_scored)
summary(m1)
```

#item analysis for HUMS, resilience and absorption
```{r}
HUMS_items <- cbind(all_scored[564:576], all_scored[266])

HUMS_items_healthy <- HUMS_items %>%
  dplyr::select("HUMS3_1","HUMS5_1","HUMS6_1","HUMS9_1","HUMS13_1", "BMRQ_absorption")

HUMS_items_healthy <- t(HUMS_items_healthy)
HUMS_items_healthy <- scale(HUMS_items_healthy)
distance <- dist(HUMS_items_healthy, method = "euclidean", upper = TRUE, diag = TRUE)

n = nrow(distance)
MDS <- cmdscale(distance, k= 2, eig = TRUE, x.ret = TRUE)
X <- MDS$points[,1:2]
X <- as.data.frame(X)
X$labels <- rownames(X)
HUMS_BMRQAbsorption <- 
  ggplot(X, aes(x=V2, y=V1, label=labels))+
  geom_text(vjust=0.2, alpha=0.6,nudge_x = -0.5)+
  geom_point() +
  theme_classic()
ggsave(HUMS_BMRQAbsorption, file='../../figures/statistical_learningfollowup/HUMS_BMRQitem.png', width=12)

HUMS_items_unhealthy <- HUMS_items %>%
  dplyr::select("HUMS1_1","HUMS2_1","HUMS4_1","HUMS7_1","HUMS8_1","HUMS10_1","HUMS11_1","HUMS12_1", "BMRQ_absorption")

HUMS_items_unhealthy <- t(HUMS_items_unhealthy)
HUMS_items_unhealthy <- scale(HUMS_items_unhealthy)
distance <- dist(HUMS_items_unhealthy, method = "euclidean", upper = TRUE, diag = TRUE)

n = nrow(distance)
MDS <- cmdscale(distance, k= 2, eig = TRUE, x.ret = TRUE)
X <- MDS$points[,1:2]
X <- as.data.frame(X)
X$labels <- rownames(X)
#HUMS_BMRQAbsorption <- 
  ggplot(X, aes(x=V2, y=V1, label=labels))+
  geom_text(vjust=0.2, alpha=0.6,nudge_x = -0.5)+
  geom_point() +
  theme_classic()
```

