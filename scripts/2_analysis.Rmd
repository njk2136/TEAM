---
title: "2_analysis"
author: "Nick Kathios"
date: '2022-10-21'
output: html_document
---
```{r}
library(tidyverse)
library(lme4)
library(lmerTest)
library(mediation)
```

#read in data
```{r}
scored_data <- read.csv(file="../data/pleasing-displeasing_followup/scored_data.csv")
master <- read.csv(file="../data/pleasing-displeasing_followup/pleasing_displeasing_scored.csv")
```

#cleaning original data before merge
```{r}
master <- master[-1]
names(master)[1] <- "ID"
names(master)[10:21] <- c('A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J','K','L')
names(master)[22:31] <-c('IADS105','IADS110','IADS220','IADS283','IADS351','IADS353',
                         'IADS423','IADS502','IADS717','IADS730')
names(master)[32:39] <- c('Envi1','Envi2','Envi3','Envi4','Envi5','Envi6','Envi7','Envi8')

just_ratings<-master[10:39] -4
cleaned <- cbind(master[1], just_ratings)

derived <- cleaned[1:13]
derivedstims <- pivot_longer(derived, A:L, names_to = "stim_name", values_to = "rating" )

IADS <- cleaned[14:23]
IADS <- cbind(cleaned[1], IADS)
IADS_stims <- pivot_longer(IADS, IADS105:IADS730, names_to = "stim_name", values_to = "rating" )

envi <- just_ratings[23:30]
envi <- cbind(cleaned[1], envi)
envi_stims <- pivot_longer(envi, Envi1:Envi8, names_to = "stim_name", values_to = "rating" )
#changing stim names for pleasing/displeasing comparisons
names(derived)[2:13] <- c("Displeasing1", "Displeasing2", "Pleasing3","Displeasing4",
                          "Pleasing5", "Pleasing6", "Displeasing7","Displeasing8",
                          "Pleasing9", "Pleasing10", "Pleasing11", "Displeasing12")

derived_plsdispls <- pivot_longer(derived, !ID, names_to = "soundID", values_to = "rating" )

derived_plsdispls$stim_name <- gsub("[0-9]", "", derived_plsdispls$soundID)

names(IADS)[2:11] <- c("Displeasing1", "Pleasing2", "Pleasing3", "Displeasing4",
                          "Pleasing5", "Pleasing6", "Displeasing7","Displeasing8",
                          "Pleasing9", "Displeasing10")
IADS_plsdispls <- pivot_longer(IADS, !ID, names_to = "soundID", values_to = "rating")

IADS_plsdispls$stim_name <- gsub("[0-9]", "", IADS_plsdispls$soundID)

names(envi)[2:9] <- c("Displeasing1", "Displeasing2", "Pleasing3", "Pleasing4",
                          "Pleasing5", "Pleasing6", "Displeasing7","Displeasing8")
envi_plsdispls <- pivot_longer(envi, !ID, names_to = "soundID", values_to = "rating")
envi_plsdispls$stim_name <- gsub("[0-9]", "", envi_plsdispls$soundID)
```

#UPDATE BASED ON WHERE Q IS IN DF
```{r}
names(scored_data)[5] <- "ID"
```

#merge the datasets
```{r}
all_scored <- merge(master, scored_data, by.x="ID", by.y="ID")
digital <-merge(derived_plsdispls, scored_data, by.x="ID", by.y="ID")
digital_pleasing <- subset(digital, stim_name=="Pleasing")
digital_displeasing <- subset(digital, stim_name="Displeasing")
IADS<-merge(IADS_plsdispls, scored_data, by.x="ID", by.y="ID")
IADS_pleasing <- subset(IADS, stim_name=="Pleasing")
IADS_displeasing <- subset(IADS, stim_name="Displeasing")
```

#H1
```{r}
m1 <- lmer(rating ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + (1 | ID) + (1 | soundID), data=digital_pleasing)
summary(m1)

m2 <- lmer(rating ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + (1 | ID) + (1 | soundID), data=digital_displeasing)
summary(m2)

m3 <- lmer(rating ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + (1 | ID) + (1 | soundID), data=IADS_pleasing)
summary(m3)
#timing follow-up
m3t <- lmer(rating ~ threat_childhood_total + threat_adolescence_total + (1 | ID) + (1 | soundID), data=IADS_pleasing)
summary(m3t)

m4 <- lmer(rating ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + (1 | ID)+ (1 | soundID), data=IADS_displeasing)
summary(m4)
#timing follow-up
m4t <- lmer(rating ~ threat_childhood_home + threat_adolescence_home + (1 | ID) + (1 | soundID), data=IADS_displeasing)
summary(m4t)
```

#H2
```{r}
m1 <- lm(MBEA_total ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum, data=all_scored)
summary(m1)
#timing follow-up
m1t <- lm(MBEA_total ~ CHAOS_child_total + CHAOS_Adolescence_total, data=all_scored)
summary(m1t)

m2 <- lm(BAT_total ~  QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum, data=all_scored)
summary(m2)
#timing follow-up
m2t <- lm(BAT_total ~ QUIC_child_total + QUIC_Adolescence_total, data=all_scored)
summary(m2t)
```

#H3
```{r}
m1 <- lm(BMRQ_total ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum, data=all_scored)
summary(m1)

m1m <- lm(BMRQ_total ~ QUIC_sum + CHAOS_sum + deprivation_sum + Threat_sum + PASS_total, data=all_scored)
summary(m1m)
## need to figure out what the correct treatment variable is
mediation <- mediate(m1,m1m, treat="QUIC_sum",mediator = "PASS_total")
summary(mediation)
#timing
m2t <- lm(BMRQ_total ~ threat_childhood_total + threat_adolescence_total, data=all_scored)
summary(m2t)
```

#exploratory
```{r}
cor.test(all_scored$HUMS_adolescence_healthy, all_scored$HUMS_adult_healthy)
cor.test(all_scored$HUMS_adolescence_unhealthy, all_scored$HUMS_adukt_unhealthy)
cor.test(all_scored$BMRQ_emotion, all_scored$QUIC_sum)

m1 <- lm(HUMS_adolescence_unhealthy ~ QUIC_Adolescence_total + CHAOS_Adolescence_total+ deprivation_Adolescence_total + threat_adolescence_total, data=all_scored)
summary(m1)

m1 <- lm(HUMS_adukt_unhealthy ~ QUIC_sum + CHAOS_sum+ deprivation_sum + Threat_sum, data=all_scored)
summary(m1)

ggplot(data=all_scored, aes(x=HUMS_adukt_unhealthy, y=QUIC_sum))+
  geom_point()
```